---
title: "Case Study II"
author: "Trace Smith & Damon Resnick"
date: "November 21, 2016"
output:
  html_document:
    keep_md: TRUE
subtitle: "Various Coding Problems"
---


```{r setup, include=FALSE}
library(knitr)
library(formatR)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=80),tidy=TRUE)
opts_chunk$set(out.width='1000px', dpi=300)
```

<br>

### Question 1

**Create the following X matrix and print it from SAS, R, and Python.**

![](https://udacity-github-sync-content.s3.amazonaws.com/_attachments/26272/1479788865/Screen_Shot_2016-11-21_at_10.27.27_PM.png)

- **SAS Code**

```{}
proc iml;
/*create 3x4 matrix*/
reset print;
x={4 5 1 2,
   1 0 3 5,
   2 1 8 2};
quit;
```

- SAS output for X matrix shown below:

![](https://github.com/daresnick/Case-Study-II-share/blob/master/ExternalFigures/sasmatrixpic.png)


- **R Code**

```{r}
mymatrix <- matrix(c(4,1,2,5,0,1,1,3,8,2,5,2),nrow=3,ncol=4)
print(mymatrix)
```

- **Python Code**

```{}
import numpy as np
x = np.matrix([[4,5,1,2],[1,0,3,5],[2,1,8,2]])
print x
```

 - Python output (Ipython Notebook):
 
 ![](https://github.com/daresnick/Case-Study-II-share/blob/master/ExternalFigures/pythonmatrixpic.png)

<br>

### Question 2

- **Answer the following questions for Air Products & Chemicals, Inc. stock (symbol = `ADP`):**


- **1.) Download the data.**


- **2.) Calculate log returns.**


- **3.) Calculate volatility measure.**


- **4.) Calculate volatility over entire length of series for various three different decay factors.**


- **5.) Plot the results, overlaying the volatility curves on the data, just as was done in the S&P example.**

<br>

### Question 3

- The built-in data set called `Orange` in R is about the growth of orange trees. The `Orange` data frame has 3 columns of records of the growth of orange trees.

**Variable description**

- *Tree*: an ordered factor indicating the tree on which the measurement is made. The ordering  is according to increasing maximum diameter.

- *age*: a numeric vector giving the age of the tree (days since 1968/12/31) circumference: a numeric vector of trunk circumferences (mm). This is probably 'circumference at breast height', a standard measurement in forestry.

- First, let's load the `Orange` data set into a data frame and examine the structure of the data:
```{r}
#Read in Orange dataset from R into data.frame
df <- data.frame(Orange)
```

```{r}
#Return first 5 rows of Orange df
head(df)
```

```{r}
#get summary of Orange dataset
summary(df)
```

```{r}
#get structure of each columns
str(df$Tree)
str(df$age)
str(df$circumference)
```

- **a) Calculate the mean and the median of the trunk circumferences for different size of the trees. (Tree)**

```{r}
#aggregate data.frame by Tree and compute mean circumference
circum.mean <- aggregate(df$circumference,by=list(df$Tree),FUN=mean)
colnames(circum.mean) <- c("Tree","Mean Circ.")
circum.mean
```

```{r}
#aggregate data.frame by Tree and compute median circumference
circum.median <- aggregate(df$circumference,by=list(df$Tree),FUN=median)
colnames(circum.median) <- c("Tree","Median Circ.")
circum.median
```

- **b) Make a scatter plot of the trunk circumferences against the age of the tree. Use different plotting symbols for different size of trees.**labs(title="Scatter Plot \n Age vs Circumference by Tree",x="Age",y="Circumference",
         colour="Tree")

```{r}
#Load ggplot2
library(ggplot2)

#Scatter plot
p <- ggplot(df) + geom_point(aes(y=circumference,x=age,colour=Tree, shape = Tree), size = 3) +
  scale_colour_hue(l=80, c=150)
p + labs(title="Age vs Circumference by Tree",x="Age",y="Circumference",
         colour="Tree")
```

```{r}
# Line plot
p <- ggplot(df,aes(y=circumference,x=age,colour=Tree)) + geom_point(aes(shape = Tree), size = 3) +
  geom_line(size=1,alpha=0.8) + scale_colour_hue(l=80, c=150)
p + labs(title="Age vs Circumference by Tree",x="Age",y="Circumference",
         colour="Tree")
```


- **c) Display the trunk circumferences on a comparative boxplot against tree. Be sure you order the boxplots in the increasing order of maximum diameter.**

```{r}
#Determine the max circum by each group and reorder the levels accordingly 
circum.max <- aggregate(df$circumference,by=list(df$Tree),FUN=max)#aggregate for max circum
colnames(circum.max) <- c("Tree","Max Circum.") #rename columns
circum.max
```

```{r, echo=TRUE}
factor(df$Tree,c("3","1","5","2","4")) #reorder the boxplot for max circum. by tree
```

```{r}
p<-ggplot(df,aes(x=Tree,y=circumference))+ geom_boxplot(aes(fill=Tree))# ggplot: boxplot 
p + labs(title="Box Plot: Trunk Circumference", y="Circumference",x="Tree")
```

<br>

### Question 4

- **1.)	First, download a 'Temp' data set. Find the difference between the maximum and the minimum monthly average temperatures for each country and report/visualize top 20 countries with the maximum differences for the period since 1900.**

<br>

#### Load data
```{r}
tempraw <- read.csv("./Data/Temp.csv",header=TRUE)
temp <- tempraw
#Need to make Date column into a character in order to use grepl to extract out other date format
temp$Date <- as.character(temp$Date)
#This deletes all the dates below 1900 because all of those dates are in a different format with "-" and not "/"
temp <- temp[!grepl("-",temp$Date),]
# Remove any columns with "NA" just to be careful
temp1 <- temp[!(is.na(temp$Date)),]
temp1 <- temp1[!(is.na(temp1$Monthly.AverageTemp)),]
temp1 <- temp1[!(is.na(temp1$Monthly.AverageTemp.Uncertainty)),]
temp1 <- temp1[!(is.na(temp1$Country)),]
#Make Country column a character to make it easier later
temp1$Country <- as.character(temp1$Country)
```


```{r}
#Aggregate for max and min average temps
temp.max <- aggregate(temp1["Monthly.AverageTemp"],by=temp1["Country"],FUN=max)
temp.min <- aggregate(temp1["Monthly.AverageTemp"],by=temp1["Country"],FUN=min,na.rm=TRUE)
```

```{r}
#Create new data.frame to join the two aggregated list
data <- data.frame(temp.max,temp.min)
#Drop extra Country column
data$Country.1 <- NULL
head(data)
#Rename column
colnames(data)<-c("Country","Max Avg. Temp","Min Avg. Temp")
head(data)
#Take difference between max and min avg. temp columns
data$Diff <- data$'Max Avg. Temp' - data$'Min Avg. Temp'

#Sort the dataframe by decreasing Diff
data <-data[order(data$Diff,data$Country,decreasing = TRUE),]
head(data, 20)
#Subset the data to only take the first 20 columns with highest temp diff.
data.sub <- data[1:20,] 
```

```{r}
#####Needs Changing.....
#plot Country vs Temp Diff
library(ggplot2)
#p <- ggplot(data.sub,aes(Country,fill=Diff))+geom_bar() + coord_flip()
#p + labs(title="Country vs Change in Temperature", x="Maximum - Minimum Avg. Monthly Temp", y = "Country")

p <- ggplot(data.sub) + geom_point(aes(x=Country,y=Diff), size = 3, colour="Red")
p + labs(title="Difference per Country") + 
  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")

```


- **2.) Select a subset of data called 'UStemp' where US land temperatures from 01/01/1990 in Temp data. Use UStemp dataset to answer the followings.**

```{r}
temp.usa <- subset(temp1,temp1$Country == "United States")
head(temp.usa)
which(temp.usa$Date == "1/1/90")
temp.usa <- temp.usa[-c(1:1080),]
temp.usa$Date <- as.Date(temp.usa$Date, format="%m/%d/%y")
```

<br>

  - **a) Create a new column to display the monthly average land temperatures in Fahrenheit (°F).**
  
```{r}
temp.usa$Temp_F <- ((temp.usa$Monthly.AverageTemp * (9/5)) + 32)
```
  
<br>

  - **b) Calculate average land temperature by year and plot it. The original file has the average land temperature by month.** 

```{r}
temp.usa$year <- substr(temp.usa$Date,1,4)
temp.usa.year <- aggregate(temp.usa$Temp_F,by=list(temp.usa$year),FUN=mean)
colnames(temp.usa.year) <- c("Year","AvgTemp_F")
#plot(temp.usa.year)
#temp.usa.year$year <- as.integer(temp.usa.year$Year)
p <- ggplot(temp.usa.year) + geom_point(aes(x=Year,y=AvgTemp_F), size = 3, colour="Red")
p + labs(title="Yearly Avg. Temperature") + 
  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")
```

<br>

  - **c) Calculate the one year difference of average land temperature by year and provide the maximum difference (value) with corresponding two years.**
```{r}
temp.usa.year.diff <- temp.usa.year$AvgTemp_F[1:23]-temp.usa.year$AvgTemp_F[2:24]
temp.usa.year.diff.year<- c("1990-1991", "1991-1992", "1992-1993", "1993-1994", "1994-1995", "1995-1996", "1996-1997", "1997-1998", "1998-1999", "1999-2000", "2000-2001", "2001-2002", "2002-2003", "2003-2004", "2004-2005", "2005-2006", "2006-2007", "2007-2008", "2008-2009", "2009-2010", "2010-2011", "2011-2012", "2012-2013")
temp.usa.ydiff <- data.frame(temp.usa.year.diff.year, temp.usa.year.diff)
colnames(temp.usa.ydiff) <- c("Years","AvgTempDiff")
#plot(temp.usa.ydiff)
p <- ggplot(temp.usa.ydiff) + geom_point(aes(x=Years,y=AvgTempDiff), size = 3, colour="Red")
p + labs(title="Yearly Average Difference") + 
  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")
```

<br>

- **3.) Download 'CityTemp' data set. Find the difference between the maximum and the minimum temperatures for each major city and report/visualize top 20 cities with maximum differences for the period since 1900.**  

#### Load data
```{r}
citytempraw <- read.csv("./Data/CityTemp.csv",header=TRUE)
citytemp <- citytempraw
#Need to make Date column into a character in order to use grepl to extract out other date format
citytemp$Date <- as.character(citytemp$Date)
#This deletes all the dates below 1900 because all of those dates are in a different format with "-" and not "/"
citytemp <- citytemp[!grepl("-",citytemp$Date),]
# Remove any columns with "NA" just to be careful
citytemp1 <- citytemp[!(is.na(citytemp$Date)),]
citytemp1 <- citytemp1[!(is.na(citytemp1$Monthly.AverageTemp)),]
citytemp1 <- citytemp1[!(is.na(citytemp1$Monthly.AverageTemp.Uncertainty)),]
citytemp1 <- citytemp1[!(is.na(citytemp1$City)),]
citytemp1 <- citytemp1[!(is.na(citytemp1$Country)),]
citytemp1 <- citytemp1[!(is.na(citytemp1$Latitude)),]
citytemp1 <- citytemp1[!(is.na(citytemp1$Longitude)),]
#Make other columns a character to make it easier later
citytemp1$City <- as.character(citytemp1$City)
citytemp1$Country <- as.character(citytemp1$Country)
citytemp1$Latitude <- as.character(citytemp1$Latitude)
citytemp1$Longitude <- as.character(citytemp1$Longitude)
```


```{r}
#Aggregate for max and min average temps
citytemp.max <- aggregate(citytemp1["Monthly.AverageTemp"],by=citytemp1["City"],FUN=max)
citytemp.min <- aggregate(citytemp1["Monthly.AverageTemp"],by=citytemp1["City"],FUN=min,na.rm=TRUE)
```


```{r}
#Create new data.frame to join the two aggregated list
citydata <- data.frame(citytemp.max,citytemp.min)
#Drop extra Country column
citydata$City.1 <- NULL
head(citydata)
#Rename column
colnames(citydata)<-c("City","Max Avg. Temp","Min Avg. Temp")
head(citydata)
#Take difference between max and min avg. temp columns
citydata$Diff <- citydata$'Max Avg. Temp' - citydata$'Min Avg. Temp'

#Sort the dataframe by decreasing Diff
citydata <-citydata[order(citydata$Diff,citydata$City,decreasing = TRUE),]
head(citydata, 20)
#Subset the data to only take the first 20 columns with highest temp diff.
citydata.sub <- citydata[1:20,]

p <- ggplot(citydata.sub) + geom_point(aes(x=City,y=Diff), size = 3, colour="Red")
p + labs(title="Difference per City") + 
  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")

```


<br>

- **4.) Compare the two graphs in (i) and (iii)  and comment it.**

```{r}
#p1 <- ggplot(data.sub) + geom_point(aes(x=Country,y=Diff), size = 3, colour="Blue")
#p1 + labs(title="Difference per Country") + 
#  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")
#p2 <- ggplot(citydata.sub) + geom_point(aes(x=City,y=Diff), size = 3, colour="Blue2")
#p2 + labs(title="Difference per City") + 
#  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")


dffc <- c(data.sub$Country, citydata.sub$City)
dffdiff <- c(data.sub$Diff, citydata.sub$Diff)
dffcd <- data.frame(dffc, dffdiff)

p3 <- ggplot(dffcd) + geom_point(aes(x=dffc,y=dffdiff), size = 3, colour="Steelblue")
p3 + labs(title="Difference per Country and City") + 
  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = "none")

#plot3 <- ggplot(NULL) + geom_point(data = data.sub, aes(x=Country,y=Diff)) + geom_step(data = citydata.sub, aes(x=City,y=Diff))
#plot3
```

<br>

